{"ast":null,"code":"import _defineProperty from \"/Users/christophecaillet/Dev_local/React/grandcompte/leospa-main/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"/Users/christophecaillet/Dev_local/React/grandcompte/leospa-main/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/christophecaillet/Dev_local/React/grandcompte/leospa-main/src/Layouts/Pages/Gestion.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, Fragment, useEffect } from \"react\";\nimport { useLocation, useHistory } from \"react-router-dom\";\nimport { getDatabase, ref, onValue, set, child, get, remove } from \"firebase/database\";\nimport { useAuthState } from \"react-firebase-hooks/auth\";\nimport { auth } from \"../../firebase\";\nimport { toast } from \"react-toastify\";\n\nfunction useQuery() {\n  const _useLocation = useLocation(),\n        search = _useLocation.search;\n\n  return React.useMemo(() => new URLSearchParams(search), [search]);\n}\n\nconst Gestion = props => {\n  const _useAuthState = useAuthState(auth),\n        _useAuthState2 = _slicedToArray(_useAuthState, 3),\n        user = _useAuthState2[0],\n        loading = _useAuthState2[1],\n        error = _useAuthState2[2];\n\n  const _useState = useState(false),\n        _useState2 = _slicedToArray(_useState, 2),\n        userLogged = _useState2[0],\n        setUserLogged = _useState2[1];\n\n  const _useState3 = useState([]),\n        _useState4 = _slicedToArray(_useState3, 2),\n        liste = _useState4[0],\n        setListe = _useState4[1];\n\n  const _useState5 = useState(false),\n        _useState6 = _slicedToArray(_useState5, 2),\n        compte = _useState6[0],\n        setCompte = _useState6[1];\n\n  const _useState7 = useState(false),\n        _useState8 = _slicedToArray(_useState7, 2),\n        isCopied = _useState8[0],\n        setIsCopied = _useState8[1];\n\n  let query = useQuery();\n  let location = useLocation();\n  const db = getDatabase();\n  const dbRef = ref(getDatabase());\n  const history = useHistory();\n  useEffect(() => {\n    auth.onAuthStateChanged(function (user) {\n      setUserLogged(user);\n\n      if (user) {\n        const prospectRef = ref(db, \"prospect/\" + user.uid);\n        onValue(prospectRef, snapshot => {\n          const data = snapshot.val();\n          setCompte(data.restant);\n          setListe(data.liste);\n        });\n      } else {\n        history.push(\"/\");\n      }\n    });\n  }, []);\n\n  async function copyTextToClipboard(text) {\n    if (\"clipboard\" in navigator) {\n      return await navigator.clipboard.writeText(text);\n    } else {\n      return document.execCommand(\"copy\", true, text);\n    }\n  }\n\n  const handleCopyClick = copyText => {\n    // Asynchronously call copyTextToClipboard\n    copyTextToClipboard(copyText).then(() => {\n      // If successful, update the isCopied state value\n      setIsCopied(true);\n      setTimeout(() => {\n        setIsCopied(false);\n      }, 1500);\n    }).catch(err => {\n      console.log(err);\n    });\n  };\n\n  const generate = () => {\n    if (compte > 0) {\n      get(child(dbRef, \"prospect/\".concat(userLogged.uid))).then(snapshot => {\n        if (snapshot.exists()) {\n          const data = snapshot.val();\n          const pass = Math.round(Date.now()).toString(36);\n          const liste = data.liste ? [...data.liste] : [];\n          const newCompte = {\n            createdAt: Date.now(),\n            pass\n          };\n          liste.push(newCompte);\n          data.liste = liste;\n          data.restant = data.restant - 1;\n          set(ref(db, \"prospect/\" + userLogged.uid), data);\n          set(ref(db, \"pass/\" + pass), _objectSpread({}, newCompte, {\n            prospect: userLogged.uid\n          }));\n          toast.success(\"Le code a bien été généré !\", {\n            position: toast.POSITION.TOP_CENTER\n          });\n        } else {\n          console.log(\"No data available\");\n        }\n      });\n    } else {// toast vous n'avez plus de comptes disponibles\n    }\n  };\n\n  const deletePass = pass => {\n    get(child(dbRef, \"prospect/\".concat(userLogged.uid))).then(snapshot => {\n      if (snapshot.exists()) {\n        console.log(\"pass\", pass);\n        const data = snapshot.val();\n        data.liste = data.liste.filter(x => x.pass != pass);\n        data.restant = data.restant + 1;\n        set(ref(db, \"prospect/\" + userLogged.uid), data);\n        remove(ref(db, \"pass/\" + pass));\n        toast.error(\"Le code a bien été supprimé !\", {\n          position: toast.POSITION.TOP_CENTER\n        });\n      } else {\n        console.log(\"No data available\");\n      }\n    });\n  };\n\n  return React.createElement(Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117\n    },\n    __self: this\n  }, React.createElement(\"section\", {\n    className: \"contact\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"container\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"row\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"col-lg-8 col-md-10 m-auto\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"sec-heading\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122\n    },\n    __self: this\n  }, React.createElement(\"h3\", {\n    className: \"sec-title\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123\n    },\n    __self: this\n  }, \"Gestion de mes comptes UNEXTRA\"), React.createElement(\"p\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124\n    },\n    __self: this\n  }, \"Suivez l'\\xE9volution de vos comptes.\"), \" \"))), React.createElement(\"div\", {\n    className: \"row\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"col-lg-10 col-md-12 m-auto\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"mb-5\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130\n    },\n    __self: this\n  }, \"NOMBRE DE COMPTES RESTANTS : \", compte, \" \", compte > 0 && React.createElement(\"button\", {\n    onClick: generate,\n    type: \"button\",\n    style: {\n      marginLeft: 50,\n      backgroundColor: \"#4CAF50\",\n      border: \"none\",\n      color: \"white\",\n      textAlign: \"center\",\n      textDecoration: \"none\",\n      display: \"inline-block\",\n      fontSize: 16,\n      paddingRight: 10,\n      paddingLeft: 10\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133\n    },\n    __self: this\n  }, \"G\\xE9nerer un code\")), React.createElement(\"ul\", {\n    class: \"list-group\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153\n    },\n    __self: this\n  }, liste && liste.map((el, id) => {\n    const createdAt = new Date(el.createdAt).toLocaleDateString(\"fr-FR\");\n    const validatedAt = el.validatedAt ? new Date(el.validatedAt).toLocaleDateString(\"fr-FR\") : null;\n    return React.createElement(\"li\", {\n      key: id,\n      class: \"list-group-item d-flex justify-content-between align-items-center\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168\n      },\n      __self: this\n    }, \"Code \\xE0 partager : \", el.pass, \" \", !validatedAt && React.createElement(\"button\", {\n      style: {\n        marginLeft: 10,\n        backgroundColor: \"#4CAF50\",\n        border: \"none\",\n        color: \"white\",\n        textAlign: \"center\",\n        textDecoration: \"none\",\n        display: \"inline-block\",\n        fontSize: 14,\n        paddingRight: 10,\n        paddingLeft: 10\n      },\n      onClick: () => handleCopyClick(el.pass),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186\n      },\n      __self: this\n    }, isCopied ? \"Copié !\" : \"Copier\"))), React.createElement(\"div\", {\n      className: \"d-flex justify-content-between\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      class: \"font-italic\",\n      style: {\n        fontSize: 13\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191\n      },\n      __self: this\n    }, \"Cr\\xE9\\xE9 le \", createdAt), React.createElement(\"div\", {\n      class: \"font-italic\",\n      style: {\n        fontSize: 13,\n        marginLeft: 100\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194\n      },\n      __self: this\n    }, validatedAt ? \"Validé le \" + validatedAt : \"Non utilisé\"))), !validatedAt && React.createElement(\"button\", {\n      onClick: () => deletePass(el.pass),\n      type: \"button\",\n      style: {\n        backgroundColor: \"#f44336\",\n        border: \"none\",\n        color: \"white\",\n        textAlign: \"center\",\n        textDecoration: \"none\",\n        display: \"inline-block\",\n        fontSize: 16,\n        paddingRight: 10,\n        paddingLeft: 10\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205\n      },\n      __self: this\n    }, \"Supprimer\"));\n  })))))));\n};\n\nexport default Gestion;","map":{"version":3,"sources":["/Users/christophecaillet/Dev_local/React/grandcompte/leospa-main/src/Layouts/Pages/Gestion.js"],"names":["React","useState","Fragment","useEffect","useLocation","useHistory","getDatabase","ref","onValue","set","child","get","remove","useAuthState","auth","toast","useQuery","search","useMemo","URLSearchParams","Gestion","props","user","loading","error","userLogged","setUserLogged","liste","setListe","compte","setCompte","isCopied","setIsCopied","query","location","db","dbRef","history","onAuthStateChanged","prospectRef","uid","snapshot","data","val","restant","push","copyTextToClipboard","text","navigator","clipboard","writeText","document","execCommand","handleCopyClick","copyText","then","setTimeout","catch","err","console","log","generate","exists","pass","Math","round","Date","now","toString","newCompte","createdAt","prospect","success","position","POSITION","TOP_CENTER","deletePass","filter","x","marginLeft","backgroundColor","border","color","textAlign","textDecoration","display","fontSize","paddingRight","paddingLeft","map","el","id","toLocaleDateString","validatedAt"],"mappings":"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","sourcesContent":["import React, { useState, Fragment, useEffect } from \"react\";\nimport { useLocation, useHistory } from \"react-router-dom\";\nimport {\n  getDatabase,\n  ref,\n  onValue,\n  set,\n  child,\n  get,\n  remove,\n} from \"firebase/database\";\nimport { useAuthState } from \"react-firebase-hooks/auth\";\nimport { auth } from \"../../firebase\";\nimport { toast } from \"react-toastify\";\n\nfunction useQuery() {\n  const { search } = useLocation();\n\n  return React.useMemo(() => new URLSearchParams(search), [search]);\n}\n\nconst Gestion = (props) => {\n  const [user, loading, error] = useAuthState(auth);\n  const [userLogged, setUserLogged] = useState(false);\n  const [liste, setListe] = useState([]);\n  const [compte, setCompte] = useState(false);\n  const [isCopied, setIsCopied] = useState(false);\n  let query = useQuery();\n  let location = useLocation();\n  const db = getDatabase();\n  const dbRef = ref(getDatabase());\n  const history = useHistory();\n  useEffect(() => {\n    auth.onAuthStateChanged(function (user) {\n      setUserLogged(user);\n      if (user) {\n        const prospectRef = ref(db, \"prospect/\" + user.uid);\n        onValue(prospectRef, (snapshot) => {\n          const data = snapshot.val();\n          setCompte(data.restant);\n          setListe(data.liste);\n        });\n      } else {\n        history.push(\"/\");\n      }\n    });\n  }, []);\n  async function copyTextToClipboard(text) {\n    if (\"clipboard\" in navigator) {\n      return await navigator.clipboard.writeText(text);\n    } else {\n      return document.execCommand(\"copy\", true, text);\n    }\n  }\n  const handleCopyClick = (copyText) => {\n    // Asynchronously call copyTextToClipboard\n    copyTextToClipboard(copyText)\n      .then(() => {\n        // If successful, update the isCopied state value\n        setIsCopied(true);\n        setTimeout(() => {\n          setIsCopied(false);\n        }, 1500);\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  };\n  const generate = () => {\n    if (compte > 0) {\n      get(child(dbRef, `prospect/${userLogged.uid}`)).then((snapshot) => {\n        if (snapshot.exists()) {\n          const data = snapshot.val();\n          const pass = Math.round(Date.now()).toString(36);\n          const liste = data.liste ? [...data.liste] : [];\n          const newCompte = {\n            createdAt: Date.now(),\n            pass,\n          };\n          liste.push(newCompte);\n          data.liste = liste;\n          data.restant = data.restant - 1;\n          set(ref(db, \"prospect/\" + userLogged.uid), data);\n          set(ref(db, \"pass/\" + pass), {\n            ...newCompte,\n            prospect: userLogged.uid,\n          });\n          toast.success(\"Le code a bien été généré !\", {\n            position: toast.POSITION.TOP_CENTER,\n          });\n        } else {\n          console.log(\"No data available\");\n        }\n      });\n    } else {\n      // toast vous n'avez plus de comptes disponibles\n    }\n  };\n  const deletePass = (pass) => {\n    get(child(dbRef, `prospect/${userLogged.uid}`)).then((snapshot) => {\n      if (snapshot.exists()) {\n        console.log(\"pass\", pass);\n        const data = snapshot.val();\n        data.liste = data.liste.filter((x) => x.pass != pass);\n        data.restant = data.restant + 1;\n        set(ref(db, \"prospect/\" + userLogged.uid), data);\n        remove(ref(db, \"pass/\" + pass));\n        toast.error(\"Le code a bien été supprimé !\", {\n          position: toast.POSITION.TOP_CENTER,\n        });\n      } else {\n        console.log(\"No data available\");\n      }\n    });\n  };\n  return (\n    <Fragment>\n      <section className=\"contact\">\n        <div className=\"container\">\n          <div className=\"row\">\n            <div className=\"col-lg-8 col-md-10 m-auto\">\n              <div className=\"sec-heading\">\n                <h3 className=\"sec-title\">Gestion de mes comptes UNEXTRA</h3>\n                <p>Suivez l'évolution de vos comptes.</p>{\" \"}\n              </div>\n            </div>\n          </div>\n          <div className=\"row\">\n            <div className=\"col-lg-10 col-md-12 m-auto\">\n              <div className=\"mb-5\">\n                NOMBRE DE COMPTES RESTANTS : {compte}{\" \"}\n                {compte > 0 && (\n                  <button\n                    onClick={generate}\n                    type=\"button\"\n                    style={{\n                      marginLeft: 50,\n                      backgroundColor: \"#4CAF50\",\n                      border: \"none\",\n                      color: \"white\",\n                      textAlign: \"center\",\n                      textDecoration: \"none\",\n                      display: \"inline-block\",\n                      fontSize: 16,\n                      paddingRight: 10,\n                      paddingLeft: 10,\n                    }}\n                  >\n                    Génerer un code\n                  </button>\n                )}\n              </div>\n              <ul class=\"list-group\">\n                {liste &&\n                  liste.map((el, id) => {\n                    const createdAt = new Date(el.createdAt).toLocaleDateString(\n                      \"fr-FR\"\n                    );\n                    const validatedAt = el.validatedAt\n                      ? new Date(el.validatedAt).toLocaleDateString(\"fr-FR\")\n                      : null;\n                    return (\n                      <li\n                        key={id}\n                        class=\"list-group-item d-flex justify-content-between align-items-center\"\n                      >\n                        <div>\n                          <div>\n                            Code à partager : {el.pass}{\" \"}\n                            {!validatedAt && (\n                              <button\n                                style={{\n                                  marginLeft: 10,\n                                  backgroundColor: \"#4CAF50\",\n                                  border: \"none\",\n                                  color: \"white\",\n                                  textAlign: \"center\",\n                                  textDecoration: \"none\",\n                                  display: \"inline-block\",\n                                  fontSize: 14,\n                                  paddingRight: 10,\n                                  paddingLeft: 10,\n                                }}\n                                onClick={() => handleCopyClick(el.pass)}\n                              >\n                                <span>{isCopied ? \"Copié !\" : \"Copier\"}</span>\n                              </button>\n                            )}\n                          </div>\n                          <div className=\"d-flex justify-content-between\">\n                            <div class=\"font-italic\" style={{ fontSize: 13 }}>\n                              Créé le {createdAt}\n                            </div>\n                            <div\n                              class=\"font-italic\"\n                              style={{ fontSize: 13, marginLeft: 100 }}\n                            >\n                              {validatedAt\n                                ? \"Validé le \" + validatedAt\n                                : \"Non utilisé\"}\n                            </div>\n                          </div>\n                        </div>\n                        {!validatedAt && (\n                          <button\n                            onClick={() => deletePass(el.pass)}\n                            type=\"button\"\n                            style={{\n                              backgroundColor: \"#f44336\",\n                              border: \"none\",\n                              color: \"white\",\n                              textAlign: \"center\",\n                              textDecoration: \"none\",\n                              display: \"inline-block\",\n                              fontSize: 16,\n                              paddingRight: 10,\n                              paddingLeft: 10,\n                            }}\n                          >\n                            Supprimer\n                          </button>\n                        )}\n                      </li>\n                    );\n                  })}\n              </ul>\n            </div>\n          </div>\n        </div>\n      </section>\n    </Fragment>\n  );\n};\n\nexport default Gestion;\n"]},"metadata":{},"sourceType":"module"}