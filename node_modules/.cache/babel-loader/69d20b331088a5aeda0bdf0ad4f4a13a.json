{"ast":null,"code":"import _slicedToArray from \"/Users/christophecaillet/Dev_local/React/grandcompte/leospa-main/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/christophecaillet/Dev_local/React/grandcompte/leospa-main/src/Components/Login.js\";\nimport React, { useEffect, useState } from \"react\";\nimport { Link, useHistory, useLocation } from \"react-router-dom\";\nimport { auth, logInWithEmailAndPassword } from \"../firebase\";\nimport { useAuthState } from \"react-firebase-hooks/auth\";\nimport \"../Login.css\";\nimport { getDatabase, ref, set, onValue } from \"firebase/database\";\n\nfunction useQuery() {\n  const _useLocation = useLocation(),\n        search = _useLocation.search;\n\n  return React.useMemo(() => new URLSearchParams(search), [search]);\n}\n\nfunction Login() {\n  const _useState = useState(\"\"),\n        _useState2 = _slicedToArray(_useState, 2),\n        email = _useState2[0],\n        setEmail = _useState2[1];\n\n  const _useState3 = useState(\"\"),\n        _useState4 = _slicedToArray(_useState3, 2),\n        password = _useState4[0],\n        setPassword = _useState4[1];\n\n  const _useAuthState = useAuthState(auth),\n        _useAuthState2 = _slicedToArray(_useAuthState, 3),\n        user = _useAuthState2[0],\n        loading = _useAuthState2[1],\n        error = _useAuthState2[2];\n\n  const _useState5 = useState(false),\n        _useState6 = _slicedToArray(_useState5, 2),\n        code = _useState6[0],\n        setCode = _useState6[1];\n\n  const history = useHistory();\n  let query = useQuery();\n  useEffect(() => {\n    const code = query.get(\"code\");\n    setCode(code);\n\n    if (loading) {\n      // maybe trigger a loading screen\n      return;\n    }\n\n    if (user) {\n      if (code) {\n        // enregistrer uid prospect\n        const db = getDatabase();\n        const prospectRef = ref(db, \"prospectEmail/\" + code);\n        onValue(prospectRef, snapshot => {\n          const data = snapshot.val();\n          set(ref(db, \"prospect/\" + user.uid), data); // history.push(\"/prospect?code=\" + code);\n\n          history.push({\n            pathname: \"/prospect\",\n            search: \"?code=\" + code,\n            state: {\n              detail: data\n            }\n          });\n        });\n      } else {\n        history.push(\"/marketplace\");\n      }\n    }\n  }, [user, loading]);\n  return React.createElement(\"div\", {\n    className: \"mt-4\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 50\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"login__container\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 51\n    },\n    __self: this\n  }, React.createElement(\"input\", {\n    type: \"text\",\n    className: \"login__textBox\",\n    value: email,\n    onChange: e => setEmail(e.target.value),\n    placeholder: \"Adresse E-mail\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 52\n    },\n    __self: this\n  }), React.createElement(\"input\", {\n    type: \"password\",\n    className: \"login__textBox\",\n    value: password,\n    onChange: e => setPassword(e.target.value),\n    placeholder: \"Mot de passe\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 59\n    },\n    __self: this\n  }), React.createElement(\"button\", {\n    className: \"login__btn\",\n    onClick: () => logInWithEmailAndPassword(email, password, code),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 66\n    },\n    __self: this\n  }, \"Se connecter\"), React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72\n    },\n    __self: this\n  }, React.createElement(Link, {\n    to: \"/reset\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73\n    },\n    __self: this\n  }, \"Mot de passe oubli\\xE9\")), React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75\n    },\n    __self: this\n  }, \"Vous n'avez pas de compte ? \", React.createElement(Link, {\n    to: \"/register\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76\n    },\n    __self: this\n  }, \"S'enregistrer\"), \" \", \"maintenant.\")));\n}\n\nexport default Login;","map":{"version":3,"sources":["/Users/christophecaillet/Dev_local/React/grandcompte/leospa-main/src/Components/Login.js"],"names":["React","useEffect","useState","Link","useHistory","useLocation","auth","logInWithEmailAndPassword","useAuthState","getDatabase","ref","set","onValue","useQuery","search","useMemo","URLSearchParams","Login","email","setEmail","password","setPassword","user","loading","error","code","setCode","history","query","get","db","prospectRef","snapshot","data","val","uid","push","pathname","state","detail","e","target","value"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { Link, useHistory, useLocation } from \"react-router-dom\";\nimport { auth, logInWithEmailAndPassword } from \"../firebase\";\nimport { useAuthState } from \"react-firebase-hooks/auth\";\nimport \"../Login.css\";\nimport { getDatabase, ref, set, onValue } from \"firebase/database\";\n\nfunction useQuery() {\n  const { search } = useLocation();\n\n  return React.useMemo(() => new URLSearchParams(search), [search]);\n}\n\nfunction Login() {\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [user, loading, error] = useAuthState(auth);\n  const [code, setCode] = useState(false);\n  const history = useHistory();\n  let query = useQuery();\n\n  useEffect(() => {\n    const code = query.get(\"code\");\n    setCode(code);\n    if (loading) {\n      // maybe trigger a loading screen\n      return;\n    }\n    if (user) {\n      if (code) {\n        // enregistrer uid prospect\n        const db = getDatabase();\n        const prospectRef = ref(db, \"prospectEmail/\" + code);\n        onValue(prospectRef, (snapshot) => {\n          const data = snapshot.val();\n          set(ref(db, \"prospect/\" + user.uid), data);\n          // history.push(\"/prospect?code=\" + code);\n          history.push({\n            pathname: \"/prospect\",\n            search: \"?code=\" + code,\n            state: { detail: data },\n          });\n        });\n      } else {\n        history.push(\"/marketplace\");\n      }\n    }\n  }, [user, loading]);\n  return (\n    <div className=\"mt-4\">\n      <div className=\"login__container\">\n        <input\n          type=\"text\"\n          className=\"login__textBox\"\n          value={email}\n          onChange={(e) => setEmail(e.target.value)}\n          placeholder=\"Adresse E-mail\"\n        />\n        <input\n          type=\"password\"\n          className=\"login__textBox\"\n          value={password}\n          onChange={(e) => setPassword(e.target.value)}\n          placeholder=\"Mot de passe\"\n        />\n        <button\n          className=\"login__btn\"\n          onClick={() => logInWithEmailAndPassword(email, password, code)}\n        >\n          Se connecter\n        </button>\n        <div>\n          <Link to=\"/reset\">Mot de passe oubli√©</Link>\n        </div>\n        <div>\n          Vous n'avez pas de compte ? <Link to=\"/register\">S'enregistrer</Link>{\" \"}\n          maintenant.\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default Login;\n"]},"metadata":{},"sourceType":"module"}